import seaborn as sns
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np

wd="/data/jzr5814/sourmash_dnds_estimation/tests/test/create_sequence_using_NG_assumption/0.01"

def sequence_to_residues(protein_sequence):
    return list(protein_sequence)

def plot_stacked_residue_distribution(sequence1, sequence2):
    residues1 = sequence_to_residues(sequence1)
    residues2 = sequence_to_residues(sequence2)

    unique_residues = list(set(residues1 + residues2))

    # Count occurrences of each residue for each sequence
    counts1 = [residues1.count(residue) for residue in unique_residues]
    counts2 = [residues2.count(residue) for residue in unique_residues]

    # Sort by total counts
    total_counts = np.add(counts1, counts2)
    sorted_indices = np.argsort(total_counts)[::-1]
    unique_residues_sorted = [unique_residues[i] for i in sorted_indices]
    counts1_sorted = [counts1[i] for i in sorted_indices]
    counts2_sorted = [counts2[i] for i in sorted_indices]

    # Creating sorted stacked bar plot
    index = np.arange(len(unique_residues_sorted))
    plt.bar(index, counts1_sorted, label='Reference')
    plt.bar(index, counts2_sorted, bottom=counts1_sorted, label='negative_0.01_0')

    # Adding labels, legend, etc.
    plt.xticks(index, unique_residues)


    plt.tight_layout()

    plt.xlabel('Amino Acids')
    plt.ylabel('Frequency')
    plt.title('Reference Comparison to negative_0.01_0 of Amino Acids ')    
    
    plt.xticks(rotation=90, ha='right')
    
    plt.legend()  # Show legend to distinguish between distributions
    
    plt.savefig(f'{wd}/negative_0.01_0_residue_stack_ref_comparison.png',bbox_inches='tight')

    plt.show()

# Example usage with two residue sequences:
ref = "VGSLCEATVMPCRRSNGQYASAACVIITLCRPPVATRDGLRRVRVYYCISFYCGDFEDFQVSLSKPATAVPPRTEASQELSTPKCIVAHRSQQCGTSDRLELEAGARRFRSSVVNKQAVGARAHAWRQVNPQPANLPVARLKLASKSSSLFHRGEAETVATIPVLRALSGASGNAGQGLYSVCTHPTWQPSGYRSSGSPPNAGLSRVSVSAPRSDKDNTDESHGTPAKSELLQSGSFDSCWRENIGGLLTKGYMLLNLAGSRPSASRTEGLCYTMDRTHLETVNQTGQIRVREAHAISNIALATNTTTYNATSNPSTEGQILKELRTELEPNFGRLPTNKRRVGRHGQYAVLAYGPRSGIRLLHCAHEALTDRVARLRAPNPRRRALSIALNREKADSLVSGPTTPESPGTCCALSSMLQCHARTTSANIYQAIDRHCYKPDCWTSTDPTSEIKYHTSHFFHGITVCYIHLIEIAQTAGNTSTRGPAAMGPLDRITAGDSILRDMCSSSLSTLATAVRGVAFARYSLHSLVFTVIGTLGLSMKKADNSSWCRPYAQIEAVELDGAIWLRRSCVIFKAIYYPTQTRTLGERVRASSWCWVSLVYSLGLRRLRLAIIRGMMKGNRRNIMQNSHRTCTATTVYYCTQPGVNILACKSPQRYAEPTPDLVTIHLKPVLSSPCRFPNSHGRLVRPQCKIGLNNRGRNKLPTHSTVDVHVPCTTMLFHAVYLFALTVTGTWALVFHMIHALYLNLMTPPLWETPRKLEPIHLPLCKVRSNVKEYGQMFSAKQRLTPRTHSSHHERSSSSRLIRFVMHVCPIERSLKNPQVAGGPMTTRQGTENSEGGANLSILTRQAKLSLTAAVVRACSPGYANHLTLGTQGRLVEGSYPTETNTGLHSPFVAITNLRLPPQCRVEAWAASRGEWNLLLLGLSLGLCCRGIGAEAQTPSRSRVSEAERIYVIVPRTRRVLSFLRLASTDETILNDCSVFWSGIARRVRYHMAIQPITSLDGSKRRRTLKVAAVLSGDSARGTTHILNSSASLVAMAVPRRAPIKPFRRAQTLCWLPDLGLPHLIPTSMKQRKLCYFMAIAIAPIQAYAILYADIRKRRVRNAILVFFRTEKKDSLHSLLRGIRTFRLGSLDKSQLFFDLTRLMHVGIFPQGPVLGWSLRGICSVEICKPISSATVQTVRAHGCMGSDIRPLTWGTVATNPDQLMKFGTRITRTDTPIDCYCKKASRTLTFTKWLHGEPSIAMRNMPWQVLYRYHKSMRDQNKRIILNRRGISKVPRENAARGRLSSGQVQTCGDCRSAKQVDLMHHGMRKYYVGQNARHTARTARTQTGPRHEVGILHLSNAAVKLLALYIPIRRVQAAQSYKHSDIFQMSPIPSRFDYYSTQSWNSRRRLQQRVVPSFLMSTQKIVSTVRWTGFAGHEPVLHGSNPRDYSIPNRPLPHKIMLVSEQFDYMISLHGPVLHRYVPLWSNLSSSAVVNGSGVILAAIPAPNNTSTLIFGSFLLSPSGKYEDRVPLPINVVHRPLGGAMTVSPSLYYRFCDNVRTSYRAVPILTTKQTGYKAGKINSFTVIKTHESYHHLKLENTQGADKAVLWACLYNEGADSGYSSAQLRRQTKDSRKPPVNAIRKKSLYRSPTITRTGGCGAIAAITLAELHQIQLTARSSLGWVSRHLGTDTRFRTIVGEVRASSQRSLADMQSAIGARRLSSCSENREKGVPRRSRSMPEVNITRRYIVKKRIPPWIKTAHLAKVSPPAGRQSFSHNQCTSSRESQNAPVTLGVETRGLRIRDRRRHTVCTMWITPLLCLEWTSFIEQTFRISYRCIDCRSLFRSSSRKDSFSLIVAHPSNKSRILSLKMLRRIAYPRGGPVSKHYVVDHTAAIWNLRICHFLQEIFSAQITAEVNLGYDARCSRSAVLIGSRSSGFARRPDYQVPPRRENAETKVAYWKLPDHVFLPHVVKEGHCGFLDNRNGLQLSPRSFKGWRYSNLDRYWTRAKLPPVLCGGRFYRQAHLSGMCEIPYGHTVYRSDFQRNLTGHNRSFYRSIRNGMKSEEIPSSANPDLRSLLIAYNALFYAMFPTVQLGGLDQLGPYILLSCPWSHSCCYLGRKHVTTFVTNTNGRVRAPSAYTSSLTTHVDDVIREHAAKKSPMQSAYTNPPRWKNIAMRDPWHSKIGSTYEQSYPQFIVRAAALAPRSNGISQTGQMPYGFDSVPARPMLHEMLPNWHNSLDMACHVPDCPLNTLGRALLSGPESKPYYGVFHRMRKRTSSGIQGRAKAILVDGQYKRSRSTLDSRKPCVKSGLAFQMLLVAAQPNRWLRMTMYSLLTDVTGASASNSEKNNTKRNCVVSDLSAWRHVVPSLLSSWTNTRCARPGVQLEMGHAEFWSAYGPTIGLRESSITADSSSRSERTVSHFQIKLKLAVMLCAFRFSSRLSSTGRGIFLCPPTTECQRSSHVSLPGLSFRGPFEPFEKTRFPWSSSGGFSRACQASRRLQRTSISCGNVVFTLNVPVHPVRRWEKPCGYNFLASPRCPKLAHCVDKPSERSGWTPTWTFQREIYFCQTLDRPDQARFPWLVNFRFFFTGVGQYHKARINATMGLSANFAAWFTVAVLDYQQKSEANSHDGQIRAHGVTGRLQNGVPSLCPVVVAGLNGVSRRMIVDISGLSFTGHLLFGSHIQCLYTCWRSMLGRRNVAHEVAGCDIRKISPRGTTRSWAVQSCDVQIGWPFDAVLRKVRQPLKHATCILSLGWARLMLDRSNGNIVPLSPKPRWLSNCQFTDWWKPILNAPVSRIRRTKIIQVSSSDTQLTDEYGDLGPTTCIYQVKRTPLSICLWSLLSELFHCFRKRSPIELFRMPTIAIKGIKPMFSFITQCNDFNFGWKPRVHDSPMNSRVGPEQCRRKTQPRRTRTEQDLVVASVIAGCGDSRSEAIYRGSPSLSHLAHSSCALLYHTLTAKPNARPATRPTPAGMYRSSKSSDRDQAWMTGAQVSRDIVTLWFHSVMECGTFPLPFKAAICSDSVVAKVLRSWSSICTKVARSLSNANIRTVCYEDNDREDQVGWGTGPEVCSAIPPGPYHRGNWIASGSGDVHHNENTAVTHNGRRHWLSKRLASTKRIIKFPTVNLRPSPVKAEYVCQNTDCALSYCTTIYTFCPTCLGSIIQAHGMTLLTE"
protein_sequence = "VGSLCEATVMPCRRSNGQYASAACVIITLCRPPVATRDGLRRVRVYYCISFYCGDFEDFQVSLSKPATAVPPRTEASQELSTPKCIVAHRSQQCGTSDRLELEAGARRFRSSVVNKQAVGARAHAWRQVNPQRANLPVARLKFASKSSSLFHRGEAETVATIPVLRALSGASGNAGQGLDSVCTHPTWQPSGYRSSGSPPNAGLSRVSVSAPRSDKDNTDESHGTPAKSELLQSGSFDSCWRENIGGLLTKGYMLLNLAGSRPSASRTEGLCYTMDRTHLETVNQTGQIRVREAHAISNIALATNTTTYNATSNPSTEGQILKELRTEREPNFGRLPTNKRRVGRHGQYAVLAYGPRSGIRLLHCAHEALTDRVARLRAPNPRRRALSIALNREKADSLVSGPTTPESPGTCCALSSMLQCLARTTSANIYQAIDRHCYKPDCWTSTDPTSEIKYHTSHFFHGITVCYIHLIEIAQTAGNTSTRGPAAMGPLDRITAGDSILRDMCSSSLSTLATAVRGVAFARYSLHSLVFTVIGTLGLSMKKADNSSWCRPYAQIEAVELDGAIWLRRSCVIFKAIYYPTQTRTLGERVRASSWCWVSLVYSLGLRRLRLAIIRGMMNGNRRNIMQNSHRTCTATTVYYCTQPGVKILACKSPQRYAEPTPDLVTIHLKPVLSSPCRFPNSHGRLVRPQCKIGLNNRGRNKLPTHSTVDVHVPCTTMLFHAVYLFALTVTGTWALVFHMIHALYLNLMTPPLWETPRKLEPIHLPLCKVRSNVKEYGQMFSAKQRLTPRTHSSHHERSSSSRLIRFVMHVCPIERSLKNPQVAGGPMTTRQGTENSEGGANLSILTRQAKLSLTAAVVRACSPGYANHLTLGTQGRLVEGSYPTETNTGLHSPFVAITNLRLPPQCRVEAWAASRGEWNLLLLGLSLGLCCRGIGAEAQTPSRSRVSEAERIYVIVPRTRRVLSYLRLASTDETILNDCSVFWSGIARRVRYHMAIQPITSLDGSKRRRTLKVAAVLSGDSARGTTHILNSSASLVAMAVPRRAPIKPFRRAQTLCWLPDLGLPHLIPTSMKQRKLCYFMAIAIAPIQAYAILYADIRKRRVRNAILVFFRTEKKDSLHSLLRGIRTFRLGSLDKSQLFFDLTRLMHVGIFPQGPVLGWSLRGICSVEICKPISSATVQTVRAHGCMGSDIRPLTWGTVATNPDQLMKFGTRITRTDTPIDCYCKKASRTLTFTKWPHGEPSIAMRNMPWQVLYRYHKSMRDQNKRIILNRRGISKVPRENAARGRLSSGQVQTCGDCRSAKQVDLMHHGMRKYYVGQNARHTARTARTQTGPRHEVGILHLSNAAVKLLALYIPIRRVQAAQSYKHSDIFQMSPIPSRFDYYSTQSWNSRRRLQQRVVPSFLMSTQKIVSTVRWTGFAGHEPVLHGSNPRDYSIPNRPLPHKIMLVSEQFDYMISLHGPVLHRYVPLWSNLSSSAVVNGSGVILAAIPAPNNTSTLIFGSFLLSPSGKYEDRVPLPINVVHRPLGGAMTVSPSLYYRFCDNVRTSYRAVPILTTKQTGYKAGKINSFTVIKTHESYHHLKLENTQGADKAVLWACLYNEGADSGYSSAQLRRQTKDSRKPPVKAIRKKSLYRSPTITRTGGCGAIAAITLAELHQIQLTARSSLGWVSRHLGTDTRFRTIVGDVRASSQRSLADMQSAIGARRLSSCSENREKGVPRRSRSMPEVNITRRYIVKKRIPPWIKTAHLAKVSPPAGRQSFSHNQCTSSRESQNAPVTLGVETRGLRIRDRRRHTVCTMWITPLLCLEWTSFIEQTFRISYRCIDCRSLFRSSSRKDSVSLIVAHPSNKSRILSLKMLRRIAYPRGGPVSKHYVVDHTAAIWNLRICHFLQEIFSAQITAEVNLGYDARCSRSAVLIGSRSSGFARRPDYQVPPRRENAETKVAYWKLPDHVFLPHVVKEEHCGFLDNRNGLQLSPRSFKGLRYSNLDRYWTRAKLPPVLCGGRFYRQAHLSGMCEIPYGHTVYRSDFQRNLTGHNRSFYRSIRNGMKSEEIPSSANPDLRSLLIAYNALFYAMFPTVQLGGLDQLGPYILLSCPWSHSCCYLGRKHVTTFGTNTNGRVRAPSAYTSSLTTHVDDVIREHAAKKSPMQSAYTNPPRWKNIAMRDPWHSKIGSTYEQSYPQFIVRAAALAPRSNGISQTGQMPYGFDSVPARPMLHEMLPNWHNSLDMACHVPDCPLNTLGRALLSGPESKPYYGVFHRMRKRTSSGIQGRAKAILVDGQYKRSRSTLDSRKPCVKSGLAFQMLLVAAQPNRWLRMTMYSLLTDVTGASASNSEKNNTKRNCVVSDLSAWRHVVPSLLSSWTNTRCARPGVQLEMGHAEFWSAYGPTIGLRESSITADSSSRSERTGSHFQIKLKLAVMLCAFRFSSRLSSTGRGIFLCPPTTECQRSSHVSLPGLSFRGPFEPFEKTRFPWSSSGGFSRACQASRRLQRTSISCGNVVFALNVPVHPVRGWEKPCGYNFLASPRCPKLAHCVGKPSERSGWTPTWTFQREIYFCQTLDRPDQARFPWLVNFRFFFTGVGQYHKARINATMGLSANFAAWFSVAVLDYQQKSEANSHDGQIRAHGVTGRLQNGVPSLCPVVVAGLNGVSRRMIVDISGLSFTGHLLFGSHIQCLYTCWRSMLGRRNVAHEVAGCDIRKISPRGTTRSWAVQTCDVQIGWPFDAVLRKVRQPLKHATCILSLGWARLMLDRSNGNIVPLSPKPRWLANCQFTDWWKPILNAPVSRIRRTKIIQVSSSDTQLTDEYGDLGPTTCIYQVKRTPLSICLWSLLSELFHCFRKRSPIELFRMPTIAIKGIKPMFSFITQCNDFNFGWNPRVHDSPMNSRVGPEQCRRKTQPRRTRTEQDLVVASVIAGCGDSRSEAIYRGSPSLSHLAHSSCALLYHTLTAKPNARPATRPTPAGMYRSSKSSDRDQAWMTGAQVSRDIVTLWFHSVMECGTFPLPFKAAICSDSVVAKVLRSWSSICTKVARSLSNANIRTVCYEDNDREDQVGWGTGPEVCSAIPPGPYHRGNWIASGSGDGHHNENTAVTHNGRRHWLSKRLASTKRIIKFPTVNLRPSPVKAEYVCQNTDCALSYCTTIYTFCPTCLGSIIQAHGMTLLTE"

plot_stacked_residue_distribution(ref, protein_sequence)
